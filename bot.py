<сокращено для читаемости, см. предыдущий ответ>